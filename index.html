<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <title>é»‘äº‘éŸ³ä¹..ä»…ä¾›å­¦ä¹ </title>
  <link rel="stylesheet" href="./css/index.css" />
  <link rel="stylesheet" href="./css/iconfont.css" />
  <link rel="stylesheet" href="./css/player.css">
  <link rel="stylesheet" href="./css/results.css">
  <link rel="stylesheet" href="./css/comment.css">
  <link rel="stylesheet" href="./css/video.css">
</head>

<body>
  <div id="player">
    <h2 class="title">é»‘äº‘éŸ³ä¹</h2>
    <div class="search">
      <input type="text" v-model.trim='search' @keyup.enter='searchmusic' />
      <button @click="searchmusic">
        <span class="iconfont icon-search"></span>
      </button>
    </div>
    <div class="tab-wrapper">
      <!-- tabæ  -->
      <!-- <div class="tab-bar"> -->

      <!-- ä½¿ç”¨ router-link ç»„ä»¶æ¥å¯¼èˆª. -->
      <!-- é€šè¿‡ä¼ å…¥ `to` å±æ€§æŒ‡å®šé“¾æ¥. -->
      <!-- <router-link> é»˜è®¤ä¼šè¢«æ¸²æŸ“æˆä¸€ä¸ª `<a>` æ ‡ç­¾ -->
      <!-- å£°æ˜å¼å¯¼èˆª -->
      <!-- <router-link :to="'/results/'+search" class="bar-item " active-class='active'>æœç´¢ç»“æœ</router-link> -->
      <!-- <router-link :to="'/results/'+search" class="bar-item " active-class='active'>æœç´¢ç»“æœ</router-link>
        <router-link :to='"/playing/"+id' class="bar-item " active-class='active'>æ­Œæ›²æ’­æ”¾</router-link>
        <router-link to="/video" class="bar-item " active-class='active'>mv</router-link>
        <router-link to="/comment" class="bar-item " active-class='active'>æ­Œæ›²è¯„è®º</router-link> -->


      <!-- </div> -->
      <!-- å¯¹åº”çš„å†…å®¹åŒºåŸŸ -->
      <div class="tab-content">
        <!-- è·¯ç”±å‡ºå£ -->
        <!-- è·¯ç”±åŒ¹é…åˆ°çš„ç»„ä»¶å°†æ¸²æŸ“åœ¨è¿™é‡Œ -->
        <router-view></router-view>
      </div>
    </div>
  </div>


  <script src="./lib/vue.js"></script>
  <script src="./lib/vue-router.js"></script>
  <script src="./lib/axios.js"></script>
  <script src="./lib/moment.js"></script>
  <!-- è¯„è®º -->
  <script id="comment" type="text/html">
    <div class="comment-wrapper">
      <div class="items" >
        <div class="item"v-for='item in commentList'>
          <div class="left">
            <img :src="item.user.avatarUrl" alt="">
          </div>
          <div class="right">
            <div class="top">
              <span class='user'>{{item.user.nickname}}:</span>
              <span
                class='content'>{{item.content}}</span>
            </div>
            <div class="bottom">
              <div class="time">{{item.time | monment}}</div>
              <div class="like-wrapper">
                <span>ğŸ‘</span>({{item.likedCount}})
              </div>
            </div>
          </div>
        </div>
        
        </div>
        
      </div>
    </div>
  </script>
  <!-- æ’­æ”¾ -->
  <script id="playing" type="text/html">
    <div class="player">
      <div class="left">
        <img class='disc' src="./img/disc.png" alt="">
        <img class='cover' :src="coverUrl" alt="">
      </div>
      <div class="right">
        <div class="title"><img src="./img/tag.png" alt=""><span>{{songName}}</span> </div>
        <div class="singer">æ­Œæ‰‹: <span>{{singerName}}</span></div>
        <div class="album">æ‰€å±ä¸“è¾‘: <span>{{albumName}}</span></div>
        <audio class='audio' controls :src="musicUrl" autoplay loop></audio>
        <ul class='lyric-container'>
          <li class='lyric' v-for='item in lyric'>{{item}} </li>

        </ul>
      </div>
    </div>
  </script>
  <!-- æœç´¢åˆ—è¡¨ -->
  <script id="results" type="text/html">
    <div class="result-wrapper">
      <div class="song" v-for="item in songList">
        <div class="name">
          <span class="iconfont icon-play" @click='toplaymusic(item.id)'></span>
          {{item.name}}
          <span class="iconfont icon-editmedia" v-if='item.mvid != 0' @click='toMV(item.mvid)'></span>
          <span style='color:hotpink'  @click='tocomment(item.id)'> çƒ­é—¨è¯„è®º</span>
        </div>
        <div class="singer">{{item.artists | singer}}</div>
        <div class="album">ã€Š{{item.album.name}}ã€‹</div>
        <div class="time">{{item.duration | gettime}}</div>
      </div>

    </div>
  </script>
  <!-- mvæ’­æ”¾ -->
  <script id="video" type="text/html">
    <div class="video">
      <div class="title-wrapper">
        <span class='tag'>MV</span>
        <span class='title'>{{mvName}}</span>
        <span class='artist'>{{mvArtist}}</span>
      </div>
      <video :src="mvUrl" controls autoplay loop></video>
    </div>
  </script>

  <script>
    //1.å®šä¹‰è·¯ç”±ç»„ä»¶
    //è¯„è®º
    const comment = {
      template: '#comment',
      data(){
        return {
          commentList:[]
        }
      },
      created(){
   
        axios
        .get(
          `https://autumnfish.cn/comment/hot?id=${this.$route.params.id}&type=0`
        )
        .then(backData => {
             
          console.log(backData.data.hotComments);
          this.commentList = backData.data.hotComments;
        });
        
      },
      filters:{
        monment(val){
          let str = moment(val).format('YYYY-MM-DD HH:mm:ss');
          return str;
        }
      }
    }
    //æ­Œæ›²æ’­æ”¾
    const playing = {
      template: '#playing',
      data() {
        return {
          musicUrl: '',
          coverUrl: '',
          albumName: '',
          singerName: '',
          songName: '',
          lyric: []

        }
      },
      created() {
        console.log(this.$route.params.id);
        //è·å–æ­Œæ›²url
        axios.get('https://autumnfish.cn/song/url?id=' + this.$route.params.id).then(data => {
          console.log(data);
          this.musicUrl = data.data.data[0].url
        }).catch()


        // è°ƒç”¨æ¥å£ è·å– æ­Œæ›²ä¿¡æ¯
        axios
          .get(`https://autumnfish.cn/song/detail?ids=${this.$route.params.id}`)
          .then(backData => {
            // console.log(backData)
            // å°é¢åœ°å€
            this.coverUrl = backData.data.songs[0].al.picUrl;
            // ä¸“è¾‘å
            this.albumName = backData.data.songs[0].al.name;
            // æ­Œæ‰‹å
            this.singerName = backData.data.songs[0].ar[0].name;
            // æ­Œå
            this.songName = backData.data.songs[0].name;
          });

        // æ­Œè¯
        axios
          .get(`https://autumnfish.cn/lyric?id=${this.$route.params.id}`)
          .then(backData => {
            console.log(backData)
            // ä¿å­˜æ­Œè¯ä¸ºæ•°ç»„
            this.lyric = backData.data.lrc.lyric.split('\n');
            // å¾ªç¯æ•°ç»„ åˆ‡æ‰ [00:00.000]
            for (let i = 0; i < this.lyric.length; i++) {
              this.lyric[i] = this.lyric[i].slice(11);
            }
          });
      }
    }
    //æœç´¢åˆ—è¡¨ç»„ä»¶
    const results = {
      template: '#results',
      data() {
        return {
          songList: []
        }
      },
      filters: {
        singer(val) {
          let singname = '';
          for (let i = 0; i < val.length; i++) {
            singname += val[i].name;
            singname += '|';
          }
          singname = singname.slice(0, -1);
          return singname;
        },
        gettime(time) {
          let min = ~~(time / 1000 / 60) < 10 ? '0' + ~~(time / 1000 / 60) : ~~(time / 1000 / 60);
          let sec = ~~(time / 1000 % 60) < 10 ? '0' + ~~(time / 1000 % 60) : ~~(time / 1000 % 60);
          return min + ':' + sec;
        }
      },
      created() {
        console.log(this.$route.params.search);
        //è·å–æ­Œæ›²åˆ—è¡¨
        axios
          .get(
            `https://autumnfish.cn/search?keywords=${this.$route.params.search}`
          )
          .then(backData => {
            console.log(backData.data.result.songs)
            // ä¿å­˜æ­Œæ›²åˆ—è¡¨
            this.songList = backData.data.result.songs;
          });
      },
      methods: {
        toplaymusic(id) {
          router.push('/playing/' + id); //å…¶ä¸­çš„æ•°æ®å¯¹åº”ä¸Šé¢çš„ å ä½ç¬¦
        },
        toMV(id) {
          router.push('/video/' + id); //å…¶ä¸­çš„æ•°æ®å¯¹åº”ä¸Šé¢çš„ å ä½ç¬¦
        },

        tocomment(id) {
          router.push('/comment/' + id); //å…¶ä¸­çš„æ•°æ®å¯¹åº”ä¸Šé¢çš„ å ä½ç¬¦
        }

      },

    }
    //mvæ’­æ”¾
    const video = {
      data(){
        return{
          mvName:'',
          mvUrl:'',
          mvArtist:'',
        }
      },
      template: '#video',
      created(){
        console.log(this.$route.params.mvid);
        
        axios
        .get(`https://autumnfish.cn/mv/detail?mvid=${this.$route.params.mvid}`)
        .then(backData => {
          console.log(backData)
          this.mvName = backData.data.data.name;
          this.mvUrl = backData.data.data.brs['240'];
          this.mvArtist = backData.data.data.artistName;
        });
      }

    }
    //2.å®šä¹‰è·¯ç”±
    //æ¯ä¸ªè·¯ç”±æ˜ å°„ä¸€ä¸ªç»„ä»¶
    const routes = [{
      path: '/comment/:id',
      component: comment
    }, {
      path: '/playing/:id',
      component: playing
    }, {
      path: '/results/:search', //åŠ¨æ€è·¯ç”±åŒ¹é… search å ä½
      component: results
    }, {
      path: '/video/:mvid',
      component: video
    }, ]

    //3.åˆ›å»ºrouterå®ä¾‹ ä¼ 'routes'é…ç½®
    const router = new VueRouter({
      routes
    })

    const app = new Vue({
      el: '#player',
      router,
      data: {
        search: ''
      },
      methods: {
        searchmusic() {
          console.log(this.search);
          // router.push('åœ°å€') ç¼–ç¨‹å¼å¯¼èˆª 
          router.push('/results/' + this.search); //å…¶ä¸­çš„æ•°æ®å¯¹åº”ä¸Šé¢çš„keyå ä½ç¬¦
          //åŠ¨æ€è·¯ç”±åŒ¹é…
          window.location.reload();
        }
      },
      computed: {}
    })
  </script>
</body>

</html>